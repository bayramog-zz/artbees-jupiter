"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function a(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,s){return t&&a(e.prototype,t),s&&a(e,s),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(v){var a=(_createClass(i,[{key:"init",value:function(){var e=this,t=e.element,s=e.filters,a=t.find(".jupiterx-templates-select-field");s.filter(":not([type=text])").on("change",_.debounce(e.update.bind(e),300)),s.filter("[type=text]").on("keyup",_.debounce(e.update.bind(e),300)),a.each(function(e,t){new n(v(t))})}},{key:"events",value:function(){var e=this,t=v(".jupiterx-header");if(t.length){var s=t.data("jupiterx-settings"),a=s.behavior,i=s.position;"fixed"===a&&"top"===i?(e.fixed(),e.window.resize(e.fixed.bind(e))):"sticky"===a&&(e.sticky(),e.window.scroll(e.sticky.bind(e)))}}},{key:"fixed",value:function(){var e=this,t=e.element,s=e.body,a=e.desktop;if(e.window.width()>=a){var i=v(".jupiterx-header"),n=s.offset(),l=s.hasClass("admin-bar")?n.top+i.outerHeight():i.outerHeight();t.css("top",l)}else t.css("top","")}},{key:"sticky",value:function(){var e=this,t=e.element,s=e.body,a=e.desktop,i=v(".jupiterx-header"),n=i.data("jupiterx-settings").offset,l=e.window.scrollTop();if(e.window.width()<a)t.removeClass("sticked"),t.css("top","");else if(!t.hasClass("sticked")&&n<l&&s.hasClass("jupiterx-header-sticked")){var o=s.offset(),r=s.hasClass("admin-bar")?o.top+i.outerHeight():i.outerHeight();t.addClass("sticked"),t.css("top",r)}else t.hasClass("sticked")&&l<=n&&(t.removeClass("sticked"),t.css("top",""))}},{key:"getFilters",value:function(){var a={};return this.filters.each(function(e,t){var s=(t=v(t)).val();s&&(a[t.attr("name")]=s)}),a}},{key:"update",value:function(){this.updateResults(this.getFilters())}},{key:"clearFilters",value:function(){this.filters.filter(":not([name=product_id]):not([name=posts_per_page]):not([name=s])").each(function(e,t){(t=v(t)).val()&&t.val("").trigger("change",{clearFilters:!0})})}}]),i);function i(e){_classCallCheck(this,i);var t=e.element,s=e.updateResults;this.element=t,this.filters=this.element.find(".filter-field"),this.contentFilter=this.filters.filter("[name=s]"),this.window=v(window),this.body=v("body"),this.updateResults=s,this.desktop=768,this.init(),this.events()}var n=(_createClass(s,[{key:"init",value:function(){var s=this,t=s.element,a=s.window,e=s.checkboxes,i=s.clear,n=s.values,l=t.find(".dropdown-toggle");e.each(function(e,t){t=v(t),s.options[t.val()]=t.data("label")}),e.on("change",function(){var e=v(this);s.update(e.val(),e.is(":checked"))}),i.on("click",function(e){e.preventDefault(),e.stopPropagation(),s.clearSelected()}),n.on("change",function(e,t){t&&t.clearFilters&&s.clearSelected()}),l.on("click",function(e){e.preventDefault(),s.expand()}),v(document).on("click",function(e){a.width()>=s.desktop&&(t.is(e.target)||0!==t.has(e.target).length||s.collapse())}),t.on("click",".dropdown-menu",function(e){e.stopPropagation()})}},{key:"update",value:function(e,t){var s=this;t?this.selected.push(e):this.selected.splice(this.selected.indexOf(e),1),this.values.val(this.selected).trigger("change");var a=this.selected.map(function(e){return s.options[e]});a=a.length?a.join(", "):jupiterxTemplates.i18n.all,this.labels.text(a),this.selected.length?this.clear.addClass("show"):this.clear.removeClass("show")}},{key:"clearSelected",value:function(){this.selected.length&&(this.selected=[],this.values.val(this.selected).trigger("change"),this.labels.text(jupiterxTemplates.i18n.all),this.clear.removeClass("show"),this.checkboxes.each(function(e,t){v(t).attr("checked",!1)}))}},{key:"expand",value:function(){var e=this.element,t=this.window,s=this.menu,a=t.width()<=767?"show-mobile":"show",i=!(e.hasClass(a)||s.hasClass(a));e.toggleClass(a,i),s.toggleClass(a,i)}},{key:"collapse",value:function(){this.element.removeClass("show"),this.menu.removeClass("show")}}]),s);function s(e){_classCallCheck(this,s),this.element=v(e),this.window=v(window),this.checkboxes=this.element.find("input[type=checkbox]"),this.menu=this.element.find(".dropdown-menu"),this.values=this.element.find(".selected-values"),this.labels=this.element.find(".selected-labels"),this.clear=this.element.find(".clear-selected"),this.options={},this.desktop=768;var t=this.values.val();this.selected=t?t.split(","):[],this.init()}var l=(_createClass(o,[{key:"events",value:function(){switch(this.getPagination()){case"load_more":this.document.on("click",".jupiterx-templates-loadmore button",this.more.bind(this));break;default:this.window.on("scroll",_.throttle(this.scroll.bind(this),50))}}},{key:"scroll",value:function(){this.ready&&this.check()&&this.load(!1)}},{key:"more",value:function(){this.ready&&this.load(!1)}},{key:"reload",value:function(e){this.load(!0,e)}},{key:"load",value:function(e,s){var a=this;if(e||!a.maxed){var i=a.getFilters();a.ready=!1,a.element.children(".jupiterx-templates-placeholder, .jupiterx-templates-loader, .jupiterx-templates-empty, .jupiterx-templates-loadmore").remove(),e?(a.element.children(".jupiterx-templates-template").remove(),a.page=1,a.maxed=!1,a.placeholder(i)):a.element.append(v(a.loader())),i.page=a.page,Object.keys(i).forEach(function(e){i[e]||delete i[e]}),a.jqxhr&&a.jqxhr.abort&&a.jqxhr.abort(),a.jqxhr=v.ajax({type:"POST",url:_wpUtilSettings.ajax.url,data:{action:"jupiterx_api",method:"get_templates",filters:i}}),a.jqxhr.done(function(t){a.element.children(".jupiterx-templates-placeholder, .jupiterx-templates-loader").remove(),t.posts&&t.posts.length?(t.posts.length<i.posts_per_page&&(a.maxed=!0),t.posts.forEach(function(e){a.element.append(a.card(e,t))})):(a.maxed=!0,e&&a.element.append(v(a.empty()))),a.done(t,i),a.page++,a.ready=!0,"function"==typeof s&&s(t)})}}},{key:"done",value:function(e,t){this.maxed||"load_more"!==this.getPagination()||this.element.append(v(this.loadmore()))}},{key:"check",value:function(){var e=this.element.offset();if("object"!==(void 0===e?"undefined":_typeof(e)))return!1;var t=this.window.scrollTop()+this.window.height();return this.element.outerHeight(!1)+e.top-2*this.window.height()<t}},{key:"empty",value:function(){return'\n      <div class="jupiterx-templates-empty">\n        <svg class="sad-tear" aria-hidden="true" focusable="false" width="50" height="50" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512">\n          <path fill="currentColor" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm8-152c-13.2 0-24 10.8-24 24s10.8 24 24 24c23.8 0 46.3 10.5 61.6 28.8 8.1 9.8 23.2 11.9 33.8 3.1 10.2-8.5 11.6-23.6 3.1-33.8C330 320.8 294.1 304 256 304zm-88-64c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160-64c-17.7 0-32 14.3-32 32s14.3 32 32 32 32-14.3 32-32-14.3-32-32-32zm-165.6 98.8C151 290.1 126 325.4 126 342.9c0 22.7 18.8 41.1 42 41.1s42-18.4 42-41.1c0-17.5-25-52.8-36.4-68.1-2.8-3.7-8.4-3.7-11.2 0z"></path>\n        </svg>\n        <p class="empty-title">'+jupiterxTemplates.i18n.empty+'</p>\n        <p class="empty-info">'+jupiterxTemplates.i18n.emptyInfo+"</p>\n      </div>\n      "}},{key:"placeholder",value:function(e){for(var t=e.posts_per_page||12,s=0;s<t;s++)this.element.append(v('\n      <div class="jupiterx-templates-template jupiterx-templates-placeholder">\n        <div class="jupiterx-card">\n          <span class="jupiterx-card-img-top"></span>\n          <div class="jupiterx-card-body">\n            <span class="jupiterx-card-title"></span>\n            <span class="import-template"></span>\n          </div>\n        </div>\n      </div>\n      '))}},{key:"loader",value:function(){return'\n      <div class="jupiterx-templates-loader">\n        <span class="loader-round"></span>\n      </div>\n      '}},{key:"loadmore",value:function(){return'\n      <div class="jupiterx-templates-loadmore">\n        <button class="button">'+jupiterxTemplates.i18n.loadMore+"</button>\n      </div>\n      "}},{key:"card",value:function(t,e){var s=this,a=e.is_pro,i=s.isCustomImport,n=t.demo_url,l=t.featured_image,o=t.free_template,r=jupiterxTemplates,c=r.i18n,p=r.isPremium,u=r.proBadgeUrl,d=(r.upgradeLink,t.title),m=t.slug,h=t.psd;d=d.replace(" Jupiterx",""),m=m.replace("-jupiterx","");var f=v('\n        <div class="jupiterx-templates-template">\n          <div class="jupiterx-card">\n            '+(a||"true"===o?"":'<img class="jupiterx-pro-badge" src="'+u+'" />')+'\n            <span class="jupiterx-card-img-top" style="background-image: url('+l+');"></span>\n            <div class="jupiterx-card-body">\n              <h4 class="jupiterx-card-title">'+d+"</h4>\n              "+(p&&a||"true"===o?'<button class="btn btn-primary import-template">'+c.import+"</button>":"")+'\n              <a class="btn btn-outline-secondary preview-template" target="_blank" href="'+n+'">'+c.preview+"</a>\n              "+(h&&a?'<button class="btn btn-outline-primary psd-link">.psd</button>':"")+"\n            </div>\n          </div>\n        </div>\n      ");return f.on("click",".import-template",function(e){e.preventDefault(),i?s.importCustom(t):s.import(t)}),f.on("click",".psd-link",function(e){e.preventDefault(),v.ajax({type:"POST",url:_wpUtilSettings.ajax.url,data:{action:"jupiterx_api",method:"get_template_psd",template_name:m},success:function(e){var t=e.status,s=e.data;t&&s.psd_link&&(top.location.href=s.psd_link)}})}),f}},{key:"import",value:function(e){var t=jupiterxTemplates.i18n;jupiterx_modal({type:"warning",title:t.installTitle,text:t.installText.replace("{template}",e.title),confirmButtonText:t.confirm,cancelButtonText:t.cancel,showCancelButton:!0,showConfirmButton:!0,onConfirm:function(){jupiterx_modal({type:"warning",title:t.mediaTitle,text:t.mediaText,confirmButtonText:t.mediaConfirm,cancelButtonText:t.mediaCancel,showCancelButton:!0,showConfirmButton:!0,onConfirm:function(){new r({media:!1,data:e,partial:!1})},onCancel:function(){new r({media:!0,data:e,partial:!1})}})}})}},{key:"importCustom",value:function(a){var i=jupiterxTemplates.i18n,e=v("\n        <h6>"+i.customTitle+'</h6>\n        <ul class="import-types">\n          <li>\n            <div class="custom-control custom-radio">\n              <input type="radio" class="custom-control-input" name="templates-import-type" id="templates-complete-import" checked>\n              <label class="custom-control-label" for="templates-complete-import">\n                <strong>'+i.completeImportTitle+"</strong>\n              </label>\n            </div>\n            <p>"+i.completeImportText+'</p>\n          </li>\n          <li>\n            <div class="custom-control custom-radio">\n              <input type="radio" class="custom-control-input" name="templates-import-type" id="templates-partial-import" '+(jupiterxTemplates.template?"checked":"")+'>\n              <label class="custom-control-label" for="templates-partial-import">\n                <strong>'+i.partialImportTitle+"</strong>\n              </label>\n            </div>\n            <p>"+i.partialImportText+'</p>\n          </li>\n        </ul>\n        <hr>\n        <div class="custom-control custom-checkbox">\n          <input type="checkbox" class="custom-control-input" name="templates-include-media" id="templates-include-media" checked>\n          <label class="custom-control-label" for="templates-include-media">'+i.customMediaText+"</label>\n        </div>\n      ");jupiterx_modal({modalCustomClass:"jupiterx-templates-custom-install-modal",title:i.installTitle,text:e,type:"warning",confirmButtonText:i.install,cancelButtonText:i.discard,showCancelButton:!0,showConfirmButton:!0,showCloseButton:!0,showLearnmoreButton:!1,onConfirm:function(){var e=v("input#templates-include-media").prop("checked"),t=v("input#templates-partial-import").prop("checked"),s=(t?"":""+i.completeImportWarning)+" "+i.askContinue;jupiterx_modal({title:i.installTitle,text:s,type:"warning",confirmButtonText:i.yes,cancelButtonText:i.cancel,showCancelButton:!0,showConfirmButton:!0,showCloseButton:!0,showLearnmoreButton:!1,onConfirm:function(){new r({media:e,data:a,partial:t})}})}})}}]),o);function o(e){_classCallCheck(this,o);var t=e.node,s=e.getFilters,a=e.getPagination,i=e.customImport;this.element=v(t),this.window=v(window),this.document=v(document),this.getFilters=s,this.getPagination=a,this.isCustomImport=i,this.jqxhr=null,this.page=1,this.ready=!0,this.maxed=!1,this.cache={},this.events()}var r=(_createClass(c,[{key:"getActions",value:function(e){return e?["preparation","upload","unzip","validate","install_plugins","activate_plugins","theme_content","plugins_content","finalize"]:["preparation","backup_db","backup_media_records","reset_db","upload","unzip","validate","install_plugins","activate_plugins","custom_tables","theme_content","setup_pages","plugins_content","settings","menu_locations","theme_widget","restore_media_records","finalize"]}},{key:"run",value:function(){var a=this,i=a.actions,e=a.media,t=a.partial,s=a.data;"theme_content"!==i[a.current]?v.ajax({type:"POST",url:_wpUtilSettings.ajax.url,timeout:0,data:{action:"jupiterx_api",method:"import_template",type:i[a.current],import_media:e,template_id:s.id,template_name:s.title,partial_import:t},beforeSend:function(){a.modal||a.modalProgress||(a.modal=a.progress())},success:function(e){var t=e.status,s=e.message;t?"install_plugins"===i[a.current]&&e.install?v.ajax({type:"POST",url:e.url,data:e.install,success:function(){a.message(),a.current++,a.run()}}):(a.message(s),a.current++,a.current<i.length?a.run():(a.modal=null,a.done())):a.error(s)},error:function(){a.error()}}):a.importContent()}},{key:"importContent",value:function(){var a=this,e=jupiterxTemplates.adminAjaxUrl,t=a.media,s=a.partial,i=a.data,n=new URL(e);n.searchParams.append("action","jupiterx_api"),n.searchParams.append("method","import_template_content"),n.searchParams.append("import_media",t),n.searchParams.append("template_id",i.id),n.searchParams.append("template_name",i.title),n.searchParams.append("partial_import",s);var l=new EventSource(n.href);l.addEventListener("message",function(e){var t=JSON.parse(e.data),s="";t.message&&(s=t.message),!t.error&&t.status?(a.message(),a.current++,a.run()):a.error(s),l.close()})}},{key:"progress",value:function(){var e=this.partial,t=jupiterxTemplates.i18n,s=v('\n        <div class="jupiterx-modal-header">\n          <h3 class="jupiterx-modal-title">'+t.progressTitle+'</h3>\n        </div>\n        <div class="jupiterx-modal-desc">\n          <ul class="jupiterx-modal-step-list">\n            '+(e?"":'<li class="step-backup">'+t.progressBackup+' <span class="result-message"></span></li>')+'\n            <li class="step-package">'+t.progressPackage+' <span class="result-message"></span></li>\n            <li class="step-plugins">'+t.progressPlugins+' <span class="result-message"></span></li>\n            <li class="step-install">'+t.progressInstall+' <span class="result-message"></span></li>\n          </ul>\n        </div>\n      ');return jupiterx_modal({html:s,showProgress:!0,progress:"100%",showCloseButton:!1,showConfirmButton:!1,closeOnOutsideClick:!1}),s}},{key:"message",value:function(e){if(!(!this.modal instanceof jQuery)){var t=this.modal,s=this.actions,a=this.current,i=t.find(".step-backup .result-message"),n=t.find(".step-package .result-message"),l=t.find(".step-plugins .result-message"),o=t.find(".step-install .result-message");switch(s[a]){case"backup_db":case"backup_media_records":i.text(e);break;case"reset_db":i.text(e).parent().addClass("step-done");break;case"upload":case"unzip":n.text(e);break;case"validate":n.text(e).parent().addClass("step-done");break;case"install_plugins":l.text(e);break;case"activate_plugins":l.text(e).parent().addClass("step-done");break;case"custom_tables":case"theme_content":case"menu_locations":case"setup_pages":case"plugins_content":case"theme_widget":case"restore_media_records":o.text(e);break;case"finalize":o.text(e).parent().addClass("step-done")}}}},{key:"done",value:function(){var e=this,t=jupiterxTemplates.i18n;jupiterx_modal({title:t.completedTitle,text:t.completedText,type:"success",showCancelButton:!1,showConfirmButton:!0,showCloseButton:!1,showLearnmoreButton:!1,closeOnOutsideClick:!1,onConfirm:function(){jupiterxTemplates.template=e.data.id,v(window).trigger("template-installed",{title:e.data.title,id:e.data.id,partial:e.partial,media:e.media})}})}},{key:"error",value:function(e){var t=jupiterxTemplates.i18n;jupiterx_modal({title:t.errorTitle,text:e||t.errorText,type:"error",showCancelButton:!1,showConfirmButton:!0,showCloseButton:!1,showLearnmoreButton:!1,closeOnOutsideClick:!1})}}]),c);function c(e){_classCallCheck(this,c);var t=e.media,s=e.data,a=e.partial;this.modal=null,this.media=t,this.data=s,this.partial=a,this.current=0,this.actions=this.getActions(a),this.run()}var p=(_createClass(u,[{key:"init",value:function(){var e=this,t=this.element,s=this.components;t.data("loaded",!0),s.filters=new a({element:t.find(".jupiterx-templates-filters-container"),updateResults:e.updateResults.bind(this)}),s.results=new l({node:t.find(".jupiterx-templates-results"),getFilters:e.getFilters.bind(this),getPagination:e.getPagination.bind(this),customImport:e.customImport}),e.updateResults(s.filters.getFilters())}},{key:"events",value:function(){var t=this,e=t.element,l=t.components,s=e.find(".jupiterx-templates-toggle-filters .jupiterx-templates-search-field"),a=this.element.find(".jupiterx-templates-toggle-filters .toggle-button"),i=this.element.find(".jupiterx-templates-header .close-button"),n=this.element.find(".jupiterx-templates-header .clear-filters");s.each(function(e,t){function s(){var e=l.filters.contentFilter;e.val(i.val()),e.trigger("keyup")}var a=v(t),i=a.find("input"),n=a.find(".clear-button");i.on("keyup",function(e){i.val()?n.show():n.hide(),13===e.keyCode&&(e.preventDefault(),s())}),a.on("click",".search-button",function(){s()}),n.on("click",function(){n.hide(),i.val(""),s()})}),a.on("click",function(e){e.preventDefault(),t.showHide(!0)}),i.on("click",function(e){e.preventDefault(),t.showHide(!1)}),n.on("click",function(){l.filters.clearFilters()})}},{key:"updateResults",value:function(e){var t=this,s=t.element,a=t.foundPosts,i=t.count,n=t.components;t.filters=_extends({},e);var l=["s","posts_per_page","product_id"];for(var o in e)0<=l.indexOf(o)&&delete e[o];s.addClass("is-loading"),i.text(Object.keys(e).length||0),t.scroll(),n.results.reload(function(e){s.removeClass("is-loading"),a.text(e.found_posts||0)})}},{key:"getFilters",value:function(){return _extends({},this.filters)}},{key:"scroll",value:function(){var e=this.element,t=this.window,s=this.html,a=this.body,i=e.offset().top;if(a.hasClass("admin-bar")){var n=s.css("margin-top");i-=parseFloat(n)}t.scrollTop()>i&&t.scrollTop(i)}},{key:"showHide",value:function(e){var t=this.components,s=this.body;t.filters.element.toggleClass("show",e),s.toggleClass("jupiterx-templates-block-scroll",e)}},{key:"getPagination",value:function(){return this.pagination}}]),u);function u(e){var t=e.node,s=e.customImport;_classCallCheck(this,u),this.element=v(t),this.window=v(window),this.html=v("html"),this.body=v("body"),this.count=this.element.find(".jupiterx-templates-toggle-filters .filters-count"),this.foundPosts=this.element.find(".jupiterx-templates-toggle-filters .found-posts"),this.pagination=this.element.data("pagination"),this.customImport=s,this.filters={},this.components={},this.init(),this.events()}window.jupiterx=jQuery.extend({},window.jupiterx,{templates:{installedTemplate:jupiterxTemplates.installedTemplate||null,init:function(e){var s=(0<arguments.length&&void 0!==e?e:{}).customImport;v(".jupiterx-templates-search").each(function(e,t){v(t).data("loaded")||new p({node:t,customImport:s})})}}})}(jQuery);